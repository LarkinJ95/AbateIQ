
rules_version = '2';
service cloud.firestore {
  match /databases/{db}/documents {
    function authed() { return request.auth != null; }
    function hasOrg(org) { return authed() && request.auth.token.orgId == org; }
    function roleIs(r) { return authed() && request.auth.token.role == r; }
    // Everything org-scoped lives under /orgs/{orgId}/...
    match /orgs/{orgId}/{document=**} {
      allow read: if hasOrg(orgId);
      allow create, update: if hasOrg(orgId) && (roleIs('admin') || roleIs('editor'));
      allow delete: if hasOrg(orgId) && roleIs('admin');
    }
  }
}
